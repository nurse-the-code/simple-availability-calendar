# Simple Availability Calendar - Plan

## Overview

A static availability calendar built with 4 files (HTML, CSS, JS for data, JS for logic) that runs locally via `open calendar.html`. No server required.

---

## Features to Include

| Feature                 | Details                                                                                                        |
| ----------------------- | -------------------------------------------------------------------------------------------------------------- |
| **Grid layout**         | Sunday–Saturday columns, N weeks of rows                                                                       |
| **Date range**          | Fixed in data file; grid shows full weeks (dates outside range show as "no data")                              |
| **Cell display**        | Shows MMM dd format (e.g., "Jan 25")                                                                           |
| **Availability colors** | Green (available), Yellow (partial), Red (unavailable), Gray (no data)                                         |
| **Hover tooltips**      | Full Gregorian date, Hebrew date, status, optional notes                                                       |
| **Header**              | Optional title, Gregorian date range, Hebrew date range                                                        |
| **Day labels**          | Sun, Mon, Tue, Wed, Thu, Fri, Sat row                                                                          |
| **Legend**              | Visual key showing what each color means; "Limited availability" and "Ask Malachi" only appear when applicable |
| **Saturdays**           | Automatically marked as unavailable (Shabbos), even outside date range                                         |

## Features to Exclude

- No navigation (prev/next)
- No click interactions
- No event creation/editing
- No multi-day spanning events
- No Hebrew date calculation (manual in data file)
- No month separators within the grid

---

## Implementation Slices

A **vertical slice** is the minimum increment of work that delivers additional value to the user. Each slice results in a working feature that can be tested and committed independently.

| Slice | Delivers                                                  | Status |
| ----- | --------------------------------------------------------- | ------ |
| **1** | Basic HTML + CSS grid with hardcoded sample data          | Done   |
| **2** | JS data file + JS renders grid with dates from date range |        |
| **3** | Status colors applied from data                           |        |
| **4** | Saturdays automatically marked unavailable                |        |
| **5** | Dynamic legend (only shows statuses present in data)      |        |
| **6** | Hover tooltips                                            |        |

---

## Data Structure

Data is stored in `calendar-data.js` as a global variable:

```javascript
const CALENDAR_DATA = {
  title: "My Availability",
  startDate: "2026-01-25",
  endDate: "2026-02-28",
  hebrewRange: "5 Shevat – 10 Adar 5786",
  days: {
    "2026-01-25": {
      status: "available",
      hebrew: "5 Shevat",
      notes: "Free all day",
    },
    "2026-01-26": {
      status: "partial",
      hebrew: "6 Shevat",
      notes: "Available after 3pm",
    },
    "2026-01-27": {
      status: "unavailable",
      hebrew: "7 Shevat",
    },
  },
};
```

### Data Fields

| Field               | Required | Description                                                          |
| ------------------- | -------- | -------------------------------------------------------------------- |
| `title`             | No       | Optional calendar title                                              |
| `startDate`         | Yes      | First date (YYYY-MM-DD); earlier days in that week show as "no data" |
| `endDate`           | Yes      | Last date (YYYY-MM-DD); later days in that week show as "no data"    |
| `hebrewRange`       | No       | Hebrew date range display string                                     |
| `days`              | Yes      | Object keyed by YYYY-MM-DD                                           |
| `days[date].status` | Yes      | `"available"`, `"partial"`, or `"unavailable"`                       |
| `days[date].hebrew` | No       | Hebrew date string for tooltip                                       |
| `days[date].notes`  | No       | Additional notes for tooltip                                         |

---

## File Responsibilities

| File               | Purpose                                                      |
| ------------------ | ------------------------------------------------------------ |
| `calendar.html`    | Structure, container div, script/style links                 |
| `calendar.css`     | Grid layout, colors, tooltip styling                         |
| `calendar-data.js` | Title, date range, Hebrew range, per-day data (as JS object) |
| `calendar.js`      | Read data, generate grid, attach tooltips                    |

> **Note:** Data is stored in a `.js` file rather than `.json` because `fetch()` doesn't work with `file://` URLs due to browser CORS restrictions. Using a JS file that sets a global variable allows the calendar to work with `open calendar.html` without running a local server.

---

## Color Scheme

| Status        | CSS Class      | Color  | Legend Label         | Meaning                    |
| ------------- | -------------- | ------ | -------------------- | -------------------------- |
| `available`   | `.available`   | Green  | Available            | Fully available            |
| `partial`     | `.partial`     | Yellow | Limited availability | Partially available        |
| `unavailable` | `.unavailable` | Red    | Unavailable          | Not available              |
| (no data)     | `.no-data`     | Gray   | Ask Malachi          | Date not specified in JSON |

---

## Tooltip Content

On hover, display:

1. Full Gregorian date (e.g., "Sunday, January 25, 2026")
2. Hebrew date (e.g., "5 Shevat 5786")
3. Availability status
4. Notes (if present)

---

## Testing

Unit tests use **Vitest** via pnpm. Tests run with `pnpm test`, but the calendar itself requires no build step—just `open calendar.html`.

**Approach**: Test-driven development (TDD). Write a test, implement to pass, repeat.

### Architecture for Testability

| File               | Module Type             | Purpose                                                      |
| ------------------ | ----------------------- | ------------------------------------------------------------ |
| `calendar-data.js` | Regular script (global) | Sets `CALENDAR_DATA` global for browser use                  |
| `calendar.js`      | ES module               | Exports pure utility functions; reads global for browser use |
| `*.test.js`        | ES module               | Imports functions from calendar.js, injects test data        |

### Why This Structure?

1. **No build step for browser**: `calendar-data.js` loads as a regular script, setting a global. `calendar.js` loads as a module and can access that global.

2. **Testable with data injection**: Tests import only the pure functions (date parsing, formatting, iteration). Tests create their own test data rather than importing `CALENDAR_DATA`—this keeps tests isolated and fast.

3. **`fetch()` doesn't work with `file://`**: Browsers block `fetch()` for local files due to CORS. Using a JS file with a global avoids needing a local server.

---

## Technical Notes

- **Hebrew dates**: Use `hebcal` CLI to verify Hebrew date conversions when populating `calendar-data.js`

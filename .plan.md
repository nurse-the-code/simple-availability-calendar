# Simple Availability Calendar - Plan

## Overview

A static availability calendar that runs locally via `open calendar.html`. No server required. Source code lives in `src/`, data files live at the project root.

### Workflow

1. **Generate** — Run `pnpm generate-dates 2026-01-25 2026-02-28` to create `calendar-dates.js` with padded date range and Hebrew dates
2. **Edit** — Manually fill in `status` and `notes` in `calendar-statuses.js`
3. **View** — `open calendar.html` — no server, no build step

---

## Features to Include

| Feature                 | Details                                                                                                        |
| ----------------------- | -------------------------------------------------------------------------------------------------------------- |
| **Grid layout**         | Sunday–Saturday columns, N weeks of rows                                                                       |
| **Date range**          | User specifies start/end; generator pads to full weeks (see "Padded Date Range" below)                         |
| **Cell display**        | Shows MMM dd format (e.g., "Jan 25")                                                                           |
| **Availability colors** | Green (available), Yellow (partial), Red (unavailable), Gray (no data)                                         |
| **Hover tooltips**      | Full Gregorian date, Hebrew date, status, optional notes                                                       |
| **Header**              | Optional title, Gregorian date range, Hebrew date range                                                        |
| **Day labels**          | Sun, Mon, Tue, Wed, Thu, Fri, Sat row                                                                          |
| **Legend**              | Visual key showing what each color means; "Limited availability" and "Ask Malachi" only appear when applicable |
| **Saturdays**           | Automatically marked as unavailable (Shabbos), even outside date range                                         |

### Padded Date Range

The calendar grid always shows complete weeks (Sunday–Saturday). When the user specifies a date range, the generator **pads** it:

- **Start**: Extends backward to the Sunday of the first week
- **End**: Extends forward to the Saturday of the last week

Example: User specifies Jan 25–Feb 28, 2026

- Jan 25 is a Sunday → no padding needed at start
- Feb 28 is a Saturday → no padding needed at end
- Grid shows exactly Jan 25–Feb 28

Example: User specifies Jan 27–Feb 26, 2026

- Jan 27 is a Tuesday → pad back to Sunday Jan 25
- Feb 26 is a Thursday → pad forward to Saturday Feb 28
- Grid shows Jan 25–Feb 28

---

## Features to Exclude

- No navigation (prev/next)
- No click interactions
- No event creation/editing
- No multi-day spanning events
- No month separators within the grid

---

## Implementation Slices

A **vertical slice** is the minimum increment of work that delivers additional value to the user. Each slice results in a working feature that can be tested and committed independently.

| Slice | Delivers                                                                              | Status |
| ----- | ------------------------------------------------------------------------------------- | ------ |
| **1** | Basic HTML + CSS grid with hardcoded sample data                                      | Done   |
| **2** | Generator creates `calendar-dates.js` (secular dates, padded weeks) + JS renders grid | Done   |
| **3** | Status colors applied from `calendar-statuses.js`                                     |        |
| **4** | Saturdays automatically marked unavailable                                            |        |
| **5** | Dynamic legend (only shows statuses present in data)                                  |        |
| **6** | Hover tooltips (secular date, status, notes)                                          |        |
| **7** | Hebrew dates: generator computes them + tooltips display them                         |        |

---

## Data Structure

Data is split across two files to separate generated data from user-edited data.

### calendar-dates.js (Generated)

Created by the generator tool. Do not edit manually.

```javascript
const CALENDAR_DATES = {
  startDate: "2026-01-25",       // Padded start (Sunday)
  endDate: "2026-02-28",         // Padded end (Saturday)
  hebrewRange: "5 Shevat – 10 Adar 5786",
  days: {
    "2026-01-25": { hebrew: "5 Shevat" },
    "2026-01-26": { hebrew: "6 Shevat" },
    "2026-01-27": { hebrew: "7 Shevat" },
    // ... all dates in padded range
  },
};
```

### calendar-statuses.js (User-Edited)

Manually edited by the user to set title, availability, and notes.

```javascript
const CALENDAR_STATUSES = {
  title: "My Availability",
  days: {
    "2026-01-25": { status: "available", notes: "Free all day" },
    "2026-01-26": { status: "partial", notes: "Available after 3pm" },
    "2026-01-27": { status: "unavailable" },
    // ... only dates that need status/notes
  },
};
```

### Data Fields

**CALENDAR_DATES** (generated):

| Field               | Required | Description                               |
| ------------------- | -------- | ----------------------------------------- |
| `startDate`         | Yes      | Padded start date (always a Sunday)       |
| `endDate`           | Yes      | Padded end date (always a Saturday)       |
| `hebrewRange`       | Yes      | Hebrew date range for padded range        |
| `days`              | Yes      | Object keyed by YYYY-MM-DD (padded range) |
| `days[date].hebrew` | Yes      | Hebrew date string                        |

**CALENDAR_STATUSES** (user-edited):

| Field               | Required | Description                                    |
| ------------------- | -------- | ---------------------------------------------- |
| `title`             | No       | Optional calendar title                        |
| `days`              | Yes      | Object keyed by YYYY-MM-DD                     |
| `days[date].status` | No       | `"available"`, `"partial"`, or `"unavailable"` |
| `days[date].notes`  | No       | Additional notes for tooltip                   |

---

## File Responsibilities

| File                    | Generated? | Purpose                                                                                               |
| ----------------------- | ---------- | ----------------------------------------------------------------------------------------------------- |
| `calendar.html`         | No         | Structure, container div, script/style links                                                          |
| `calendar.css`          | No         | Grid layout, colors, tooltip styling                                                                  |
| `calendar-dates.js`     | Yes (tool) | Date range, Hebrew dates (padded range)                                                               |
| `calendar-statuses.js`  | No (user)  | Title, availability status and notes per date                                                         |
| `src/date-helpers.js`   | No         | Shared date utilities (formatting, parsing)                                                           |
| `src/calendar.js`       | No         | Build `CALENDAR_DATA` by merging `CALENDAR_DATES` + `CALENDAR_STATUSES`; render grid, attach tooltips |
| `src/generate-dates.js` | No         | CLI tool to create `calendar-dates.js`                                                                |

> **Note:** Data is stored in `.js` files rather than `.json` because `fetch()` doesn't work with `file://` URLs due to browser CORS restrictions. Using JS files that set global variables allows the calendar to work with `open calendar.html` without running a local server.

### Data Flow

`calendar.js` merges the two data-file globals into a single `CALENDAR_DATA` object that all rendering functions consume:

```
CALENDAR_DATES (from calendar-dates.js).      ─┐
                                               ├─→  CALENDAR_DATA  ─→  rendering
CALENDAR_STATUSES (from calendar-statuses.js) ─┘
```

This keeps the rendering code decoupled from the two-file split. The merge combines date metadata (Hebrew dates, padded range) with user-edited status and notes.

---

## Color Scheme

| Status        | CSS Class      | Color  | Legend Label         | Meaning                    |
| ------------- | -------------- | ------ | -------------------- | -------------------------- |
| `available`   | `.available`   | Green  | Available            | Fully available            |
| `partial`     | `.partial`     | Yellow | Limited availability | Partially available        |
| `unavailable` | `.unavailable` | Red    | Unavailable          | Not available              |
| (no data)     | `.no-data`     | Gray   | Ask Malachi          | Date not specified in JSON |

---

## Tooltip Content

On hover, display:

1. Full Gregorian date (e.g., "Sunday, January 25, 2026")
2. Hebrew date (e.g., "5 Shevat 5786")
3. Availability status
4. Notes (if present)

---

## Testing

Unit tests use **Vitest** via pnpm. Tests run with `pnpm test`, but the calendar itself requires no build step—just `open calendar.html`.

**Approach**: Test-driven development (TDD). Write a test, implement to pass, repeat.

### Architecture for Testability

| File                    | Module Type             | Purpose                                                          |
| ----------------------- | ----------------------- | ---------------------------------------------------------------- |
| `calendar-dates.js`     | Regular script (global) | Sets `CALENDAR_DATES` global for browser use                     |
| `calendar-statuses.js`  | Regular script (global) | Sets `CALENDAR_STATUSES` global for browser use                  |
| `src/date-helpers.js`   | Regular script (global) | Shared date utilities; conditional `module.exports` for Vitest   |
| `src/calendar.js`       | Regular script (global) | Merges globals into `CALENDAR_DATA`; rendering logic             |
| `src/generate-dates.js` | Regular script          | CLI tool; conditional `module.exports` for Vitest                |
| `src/*.test.js`         | ES module               | Imports functions via conditional `module.exports`, injects data |

### Why This Structure?

1. **No build step for browser**: All files load as regular `<script>` tags, setting globals. No `import`/`export` syntax in browser-facing code, because `<script type="module">` does not work with `file://` URLs in Chrome.

2. **Testable via conditional exports**: Source files use `if (typeof module !== 'undefined' && module.exports)` to export functions for Vitest. Vite's transform pipeline handles the CJS interop, allowing test files to use ES module `import` syntax.

3. **Separation of generated vs user data**: `calendar-dates.js` can be regenerated without losing user edits in `calendar-statuses.js`.

4. **Testable with data injection**: Tests import only the pure functions (date parsing, formatting, iteration). Tests create their own test data rather than importing globals—this keeps tests isolated and fast.

5. **`fetch()` doesn't work with `file://`**: Browsers block `fetch()` for local files due to CORS. Using JS files with globals avoids needing a local server.

---

## Technical Notes

- **Hebrew dates**: The generator tool computes Hebrew dates automatically (using a JS library or `hebcal` CLI)

---

## Generator Tool

A CLI tool to create `calendar-dates.js` from a date range.

**Usage:**

```bash
pnpm generate-dates 2026-01-25 2026-02-28
```

**What it does:**

1. Parses user-specified start and end dates
2. Pads to full weeks (Sunday–Saturday)
3. Computes Hebrew date for each day
4. Outputs `calendar-dates.js` with all dates and metadata

**Implementation:** Located in `src/` directory.

**Possible future enhancement:** Automatically pull significant Hebrew calendar dates (holidays, fast days, etc.) and pre-populate them in the generated data.
